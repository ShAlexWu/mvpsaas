# PRD - AI 数据探索平台

## 背景

面向轻技术/无技术背景的中小型客户，提供快速使用 AI 赋能数据应用和探索的平台。用户通过对接/上传数据源->一键构建知识库->AI 问数的三部曲，实现 AI 受益。

## 业务故事/场景

- 某营销品牌咨询公司含有 GB 级别，来自飞书、企业微信等文档库的各类非结构化文档，需要在平台内基于不同场景下基于文档知识进行检索，也需要在其他应用系统中对接平台，使用知识检索返回的结果进一步做下游的场景应用。
- 某科技企业的测试部门，有近万条历史缺陷数据，需要基于自然语言对缺陷数据进行分析，如：查询某人提交的某模块下的缺陷总数、和 XXXX 有关的缺陷、近三月缺陷最多的产品模块，取前三。
- 某小家电集成生产商，旗下有近 10 款家电产品，现需要在其微信小程序端接入智能客服，基于产品使用说明、售后保障服务等场景，回答线上客户对产品使用指导、故障排查、一键报修等。
- 某食品零售连锁企业，在上海有近 20 家分店，每家门店店长对于固化的已有报表无法进一步做多维度的灵活分析、归因分析、趋势预测、报表解读。需要以自然语言交互的形式获取更多有价值的分析结果，如：本周至今销量最好的蛋挞类商品、连续 7 天平均日销售额、各类商品相对总销售额的占比、为什么我的门店今年 8 月销售额比去年同期下降了？

## 功能描述

### 功能详情

#### 功能点一 数据管理

注：该功能点中提及的数据，是指来自外部源的原始文件，和知识库数据不一样，知识库数据在本 PRD 中是同步到平台后，经结构化处理 or 非结构化处理后的知识数据。

支持对接 S3、OSS、各类网盘<百度网盘/夸克网盘>、飞书/企微文档库、云端结构化数据库等，也可以手动上传本地文件到平台来进行加工。

##### 连接器

支持配置连接上述各类数据源的地址、端口、账密等信息，存储为连接器。

##### 数据同步

支持创建文件目录，根目录 root 下，最多可支持设置三级目录。

支持使用连接器拉取文件 or 上传本地文件，其中使用连接器来拉取数据的场景支持单次拉取和定期拉取，上传的本地文件支持压缩包，单次最多上传 20 个文件，单个文件大小不超过 200MB，指定文件的目的地址，即上述文件目录。

数据同步任务，每次发起数据同步都会生成一个任务，通过该任务来跟踪数据的同步状态和结果。

#### 功能点二 知识库管理

支持创建和管理多个知识库，每个知识库按目录层级划分，根目录 root 下，最多可支持设置三级目录，每个目录都可以关联用户组/用户，即对用户组/用户赋予可使用知识库的权限，被关联后，有权限使用该目录下和其所有层级子目录的知识。

支持从文件目录选取整个目录或目录中的文件，作为知识构建的对象，构建的频率可以是单次、周期、载入时触发，一键构建知识。系统提供结构化处理 or 非结构化处理的处理方式选项，用户指定（可以 2 选 1，也可以全选）处理方式后方可对构建知识。默认选项：对于非结构化数据（以 doc、docx、ppt、pptx、pdf、png 等作为后缀名的文件），默认按照非结构化方式进行分段和向量化处理；对于结构化数据（以 csv、xls、xlsx 作为后缀名的文件），默认按照结构化方式存储。云端结构化数据库（导入）默认是结构化处理（无法修改选项）。对于非结构化数据的默认数据加工流程：文档解析节点->分段节点->文本嵌入节点，所有节点都支持配置参数，都有默认值。

若某知识目录中所有文件在知识构建时配置的都是非结构化处理，则称该知识库是非结构化知识库；若所有文件在知识构建时配置的是结构化处理，则称该知识库是结构化知识库；若所含文件在知识构建时，既有配置的是结构化处理，也有配置的是非结构化处理则，则称该知识库是复合知识库。

对于知识构建，也会有对应的构建任务，当知识库目录下所有文件都构建成功，该知识库目录才是可用状态（可以被智能体关联、对外部系统提供知识检索服务）。

支持在知识库中预览原文件，支持删除知识库中的知识文件、也支持删除知识库目录，要提醒影响到的智能体，用户二次确认后才能删除。

#### 功能点三 智能体&智能体模版

##### 创建步骤

a. 设置配置项

| 序号 | 配置项               | 详情                                                                 | 是否必填/选 | 备注                                   |
| ---- | -------------------- | -------------------------------------------------------------------- | ----------- | -------------------------------------- |
| 1    | 名称                 |                                                                      | 是          | 系统内唯一                             |
| 2    | 描述                 | 对智能体的介绍                                                       | 是          | 便于通过对话调起智能体时选择匹配的智能体 |
| 3    | 人设和回复逻辑       | • 角色<br/>• 背景<br/>• 任务<br/>• 格式<br/>• 样例<br/>• 文风          | 否          |                                        |
| 4    | 开场白               | 首轮提问之前，智能体的自我介绍                                       | 否          |                                        |

b. 关联知识库

选择想要使用的知识库（支持多选）。

c. 配置参数（所有参数均有默认值或默认为空）

▪ 当仅关联非结构化知识库时，支持设置查询参数（以下参数均含默认值）

- 检索方式：向量检索、全文检索、混合检索。
- 选择 rarank 模型。
- TOP K 阈值、相似度阈值。

▪ 当仅关联结构化知识库时，支持设置当前 moi 中的对应配置项（业务逻辑、同义词等）

▪ 当关联复合知识库时，支持上述两类设置。

d. 发布和共享

对于由管理员或智能体管理员创建的智能体，创建者在发布时可选择分享的人群范围，即对用户组/用户赋予使用智能体的使用权限。被分享智能体的用户，同时也获得了智能体所关联的所有知识库的访问权限（限只读）。

##### 下线/上线/删除

可以设置智能体下线，此时全租户内不可用。删除智能体时，要强提醒，用户二次确认后才能删除。

##### 智能体模板

支持使用模板快速构建智能体。模板内，会有预置的知识库、预置内容的配置项，用户可以基于实际需要，替换知识库和调整配置项内容。

系统默认内置以下模板：

- 知识问答
  ￮ 待补
- 数据分析
  ￮ 待补

#### 功能点四 数据探索

##### 场景

- （所有用户）使用企业内已发布的共享智能体

使用智能体管理员开发并共享的智能体进行数据探索。

- （普通用户）使用有权限使用的知识库搭建智能体

当企业内的共享智能体不能满足业务需求时，支持普通用户选择有使用权限的知识库，自己搭建智能体，快速数据探索。注意：该场景下，不支持发布和共享智能体。

##### 输出类型

- 如果智能体关联的是非结构化知识库，则属于知识问答类智能体，使用相似度检索方式返回文本片段式结果。
- 如果智能体关联的是结构化知识库，则属于数据分析类智能体，使用 NL2SQL 方式返回结构化结果。
- 如果智能体关联的复合知识库，属于复合探索类智能体，同时使用上述两种方式返回结果。

##### 输出内容

- 需要展示 AI 推理的思考路径。
- 对于数据分析类智能体的返回内容，可以以普通表格和各式图表（柱状图、曲线图、饼图）展示（做得好的话，可以根据不同的分析场景，默认取不同的展示图表，如：排名类使用条状图、占比类使用饼图、走势类使用曲线图）。

#### 功能点五 角色/用户组&用户/权限

##### 角色

| 序号 | 角色名称       | 画像                                  | 权限概述                                                         | 用户数量 |
| ---- | -------------- | ------------------------------------- | ---------------------------------------------------------------- | -------- |
| 1    | 系统管理员     | 系统管理者                            | 操作平台内所有功能、管理系统内所有数据/元数据                     | 1 个     |
| 2    | 智能体管理员   | IT 信息管理员和 AI 智能体开发者       | 数据管理、知识库管理、智能体管理、数据探索、对话调起各类有操作权限的场景 | 支持多个 |
| 3    | 普通用户       | 纯 Business User                      | 使用被分享的知识库搭建智能体、使用被分享智能体进行数据探索的权限、对话调起各类有操作权限的场景 | 支持多个 |

##### 用户组/用户

支持系统内独立维护和管理用户组/用户，用户组可以包含用户组，且支持三层嵌套的用户组，即顶层用户组下可以再包含两层用户组（适配和应对企业相对复杂的部门关系和组织架构）。支持把用户组/用户关联到角色。

##### 权限

- 角色内置权限

如前述，系统暂仅基于内置的角色进行权限管控，则不涉及对自定义角色下，操作权限和对象权限的管理。

- 知识库权限

要注意结构化知识在知识库权限的基础上，还可以叠加行列级权限，举例：普通用户张三被管理员赋予财务部知识库目录（其中有经非结构化处理的财务政策相关的文件、也有经过结构化处理的近 3 年的公司营收相关的结构化明细表）的权限，同时，管理员设置了其没有权限查看：1）营收明细表中的销售额字段；2）销售区域字段中南区和北区，他使用该目录下的所有知识搭建了一个自己的智能体，则权限管控情况如下：

张三可以基于财务政策相关知识任何内容的检索，也可以基于公司营收状态进行指标查询和探索，但是涉及对营收明细表的检索时，不能查询任何与销售额有关的指标，也不能查看任何与南区和北区相关的任何指标值。

注：给实体（知识库、智能体等）下发权限的受众是用户组/用户，而非角色。例如：两个门店的店长都是店长的角色，但他们只能看到各自负责门店的数据，如果是基于角色来控权，很难配置。

#### 功能点六 对话调起操作

除了通过页面入口手动执行功能操作，也支持通过自然语言对话来发起操作，如：用户输入“我要上传一个文件”，此时会弹出上传/对接数据的窗口、“我要创建一个智能体”，此时 AI 会追问“通过模板创建还是从 0 搭建？”，用户点击模板创建后弹出智能体模板页面。

| 序号 | 场景         | 提问样例                     | AI 和系统响应                                                   |
| ---- | ------------ | ---------------------------- | ---------------------------------------------------------------- |
| 1    | 导入数据     | 我要上传一个文件             | 弹出知识库管理窗口                                               |
| 2    | 管理知识库   | 我要创建知识库               |                                                                 |
| 4    | 创建智能体   | 我要创建一个智能体           | AI 会追问“通过模板创建还是从 0 开始搭建？，文字带链接            |
| 5    | 导出数据     | 我要导出知识库               | 弹出导出知识库的窗口                                             |
| 6    | 数据探索     | 怎么报销公司的商业医疗险     | 调起公司员工日常事务解答智能体                                   |

#### 功能点七 外部系统对接

支持 API 接口实现：

- 知识构建和获取
- 智能体回复

## 安全和运维

### 数据存储

依赖系统所在云平台的安全机制。

### 用户日志

支持管理员查看所有用户的操作日志，并基于时间范围、用户组、用户筛选，具体记录的操作类型如下：

| 序号 | 操作类型               | 核心字段                                   |
| ---- | ---------------------- | ------------------------------------------ |
| 1    | 登录/登出              |                                            |
| 2    | 上传文件               | 文件名称                                   |
| 3    | 创建/删除知识库        | 知识库名称                                 |
| 4    | 构建/删除知识          | 知识名称                                   |
| 5    | 创建/下线/发布/删除智能体 | 智能体名称                                 |
| 6    | 提问                   | 问题内容                                   |
| 7    | 导出知识库             | 导出的知识库目录和导出到的系统和地址       |
| ...  | ...                    | ...                                        |